<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Save a region count matrix — saveRegionMatrix • arbalistIO</title><!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous"><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css"><script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../pkgdown.js"></script><meta property="og:title" content="Save a region count matrix — saveRegionMatrix"><meta property="og:description" content="Count the number of fragment start/end positions within user-defined genomic
regions, using the fragment file generated by Cellranger. Then, save the
resulting matrix into a HDF5 file."><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body data-spy="scroll" data-target="#toc">


    <div class="container template-reference-topic">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">arbalistIO</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.1.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles

    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu"><li>
      <a href="../articles/basic.html">Introduction to arbalistIO</a>
    </li>
  </ul></li>
      </ul><ul class="nav navbar-nav navbar-right"><li>
  <a href="https://github.com/arbalist-inc/arbalistIO/" class="external-link">
    <span class="fab fa-github fa-lg"></span>

  </a>
</li>
      </ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->



      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Save a region count matrix</h1>
    <small class="dont-index">Source: <a href="https://github.com/arbalist-inc/arbalistIO/blob/main/R/saveRegionMatrix.R" class="external-link"><code>R/saveRegionMatrix.R</code></a></small>
    <div class="hidden name"><code>saveRegionMatrix.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Count the number of fragment start/end positions within user-defined genomic
regions, using the fragment file generated by Cellranger. Then, save the
resulting matrix into a HDF5 file.</p>
    </div>

    <div id="ref-usage">
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">saveRegionMatrix</span><span class="op">(</span></span>
<span>  <span class="va">fragment.file</span>,</span>
<span>  <span class="va">output.file</span>,</span>
<span>  <span class="va">output.name</span>,</span>
<span>  <span class="va">regions</span>,</span>
<span>  barcodes <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  compress.level <span class="op">=</span> <span class="fl">6</span>,</span>
<span>  chunk.dim <span class="op">=</span> <span class="fl">20000</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div id="arguments">
    <h2>Arguments</h2>


<dl><dt id="arg-fragment-file">fragment.file<a class="anchor" aria-label="anchor" href="#arg-fragment-file"></a></dt>
<dd><p>String containing a path to a fragment file.</p></dd>


<dt id="arg-output-file">output.file<a class="anchor" aria-label="anchor" href="#arg-output-file"></a></dt>
<dd><p>String containing a path to an output HDF5 file. If none
exists, one will be created.</p></dd>


<dt id="arg-output-name">output.name<a class="anchor" aria-label="anchor" href="#arg-output-name"></a></dt>
<dd><p>String containing the name of the group inside
<code>output.file</code>, in which to save the matrix contents.</p></dd>


<dt id="arg-regions">regions<a class="anchor" aria-label="anchor" href="#arg-regions"></a></dt>
<dd><p>A <a href="https://rdrr.io/pkg/GenomicRanges/man/GRanges-class.html" class="external-link">GRanges</a> or <a href="https://rdrr.io/pkg/GenomicRanges/man/GRangesList-class.html" class="external-link">GRangesList</a> of the
regions in which to count fragments. If <code>regions</code> is a GRangesList,
the count for each entry of <code>regions</code> will include all fragment
starts/ends falling in any of the genomic intervals in its GRanges.</p></dd>


<dt id="arg-barcodes">barcodes<a class="anchor" aria-label="anchor" href="#arg-barcodes"></a></dt>
<dd><p>Character vector of cell barcodes to extract, e.g., based on
the filtered cells reported by Cellranger. If <code>NULL</code>, all barcodes are
extracted, though this is usually undesirable as not all barcodes
correspond to cell-containing droplets.</p></dd>


<dt id="arg-compress-level">compress.level<a class="anchor" aria-label="anchor" href="#arg-compress-level"></a></dt>
<dd><p>Integer scalar specifying the Zlib compression level to
use.</p></dd>


<dt id="arg-chunk-dim">chunk.dim<a class="anchor" aria-label="anchor" href="#arg-chunk-dim"></a></dt>
<dd><p>Integer scalar specifying the size of the chunks (in terms
of the number of elements) inside the HDF5 file.</p></dd>

</dl></div>
    <div id="value">
    <h2>Value</h2>
    <p>A sparse matrix is saved to <code>output.file</code> using the 10X HDF5
  format. A H5SparseMatrix referencing this file is returned
  where the rows correspond to entries of <code>regions</code>. Column names are
  set to the cell barcodes - if <code>barcodes</code> is supplied, this is directly
  used as the column names.</p>
    </div>
    <div id="details">
    <h2>Details</h2>
    <p>We count the overlap with the start/end positions of each fragment,
not the overlap with the fragment interval itself. This is because the
fragment start/ends represent the transposase cleavage events, while the
fragment interval has no real biological significance.</p>
<p>If a fragment start/end overlaps with multiple entries of <code>regions</code>, it
is not counted as the assignment is ambiguous. This should not be confused
with overlaps to multiple intervals of the same entry when <code>regions</code> is
a GRangesList; this yields a mapping to a single feature, even if the exact
interval isnot  ambiguous.</p>
<p>If the start and end for the same fragment overlap different entries of
<code>regions</code>, the counts for both entries are incremented by 1. This
reflects the fact that these positions represent distinct transposase
cleavage events for different features. However, if the start and end for the
same fragment overlap the same entry of <code>regions</code>, the entry's count is
only incremented by 1. This ensures that the count for each entry of
<code>regions</code> still follows Poisson noise and avoids an artificial
enrichment of even counts.</p>
    </div>
    <div id="author">
    <h2>Author</h2>
    <p>Aaron Lun</p>
    </div>

    <div id="ref-examples">
    <h2>Examples</h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="co"># Mocking up the fragment file.</span></span></span>
<span class="r-in"><span><span class="va">seq.lengths</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>chrA <span class="op">=</span> <span class="fl">2000</span>, chrB <span class="op">=</span> <span class="fl">10000</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">temp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempfile</a></span><span class="op">(</span>fileext <span class="op">=</span> <span class="st">".gz"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="mockFragmentFile.html">mockFragmentFile</a></span><span class="op">(</span><span class="va">temp</span>, <span class="va">seq.lengths</span>, <span class="fl">1e3</span>, cell.names <span class="op">=</span> <span class="va">LETTERS</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Mocking up some regions of interest.</span></span></span>
<span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://bioconductor.org/packages/GenomicRanges" class="external-link">GenomicRanges</a></span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">regions</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/GenomicRanges/man/GRanges-class.html" class="external-link">GRanges</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"chrA:500-1000"</span>, <span class="st">"chrB:1000-2000"</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Running the counter</span></span></span>
<span class="r-in"><span><span class="va">out</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempfile</a></span><span class="op">(</span>fileext<span class="op">=</span><span class="st">".h5"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">counts</span> <span class="op">&lt;-</span> <span class="fu">saveRegionMatrix</span><span class="op">(</span><span class="va">temp</span>, output.file<span class="op">=</span><span class="va">out</span>, output.name<span class="op">=</span><span class="st">"WHEE"</span>, regions<span class="op">=</span><span class="va">regions</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">counts</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> &lt;2 x 26&gt; sparse DelayedMatrix object of type "raw":</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>       Y  J  I ...  A  U</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1,] b9 c4 d0   . c0 c2</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [2,] 46 40 54   . 44 4c</span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top"><h2 data-toc-skip>Contents</h2>
    </nav></div>
</div>


      <footer><div class="copyright">
  <p></p><p>Developed by Jean-Philippe Fortin, Aaron Lun, Natalie Fox, Jayaram Kancherla.</p>
</div>

<div class="pkgdown">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

      </footer></div>






  </body></html>

